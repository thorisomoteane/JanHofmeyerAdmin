@model List<JanHofmeyerAdmin.Models.EventRegistration>
@{
    ViewData["Title"] = "Event Registrations";
    Layout = "_AdminLayout";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Registrations for: @ViewBag.EventTitle</h2>
    <div>
        <span class="badge bg-info fs-6">Total: @Model.Count registrations</span>
        <a href="/Events" class="btn btn-secondary ms-2">Back to Events</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        @if (Model.Any())
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Registration Date</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int counter = 1;
                    }
                    @foreach (var registration in Model)
                    {
                        <tr>
                            <td>@counter</td>
                            <td>@registration.FullName</td>
                            <td><a href="mailto:@registration.Email">@registration.Email</a></td>
                            <td>@registration.Phone</td>
                            <td>@registration.RegistrationDate.ToString("dd/MM/yyyy HH:mm")</td>
                        </tr>
                        counter++;
                    }
                </tbody>
            </table>

            <div class="mt-3">
                <button class="btn btn-primary" onclick="exportToCSV()">
                    <i class="fas fa-download"></i> Export to CSV
                </button>
            </div>
        }
        else
        {
            <p class="text-muted">No registrations yet for this event.</p>
        }
    </div>
</div>

@section Scripts {
    <script>
        function exportToCSV() {
            let csv = 'Full Name,Email,Phone,Registration Date\n';
            const rows = document.querySelectorAll('table tbody tr');
            rows.forEach(row => {
                const cols = row.querySelectorAll('td');
                csv += `"${cols[1].textContent}","${cols[2].textContent}","${cols[3].textContent}","${cols[4].textContent}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'registrations.csv';
            a.click();
        }
    </script>
}